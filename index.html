<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventaris SDN JATIASIH I</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Library untuk export PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  
  <!-- LOGIN -->
  <div id="login-container">
    <h2>Login</h2>
    <input type="text" id="login-email" placeholder="Email">
    <input type="password" id="login-password" placeholder="Password">
    <button onclick="loginUser()">Login</button>
    <p>Belum punya akun? <a href="#" onclick="showAuthView('register')">Daftar</a></p>
    <p id="auth-message" class="error-message"></p>
  </div>

  <!-- REGISTER -->
  <div id="register-container" style="display:none;">
    <h2>Daftar Akun</h2>
    <input type="text" id="register-email" placeholder="Email">
    <input type="password" id="register-password" placeholder="Password">
    <button onclick="registerUser()">Daftar</button>
    <p>Sudah punya akun? <a href="#" onclick="showAuthView('login')">Login</a></p>
    <p id="reg-message" class="error-message"></p>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard-container" style="display:none;">
    <header>
      <h1>Inventaris SDN JATIASIH I</h1>
      <div>
        <button onclick="printLaporan()">Cetak Laporan</button>
        <button onclick="downloadLaporanPDF()">Unduh PDF</button>
        <button class="logout-btn" onclick="logoutUser()">Logout</button>
      </div>
    </header>

    <div id="main-content">
      <nav id="sidebar">
        <a href="#" class="nav-item" onclick="showView('beranda')">Beranda</a>
        <a href="#" class="nav-item" onclick="showView('gedung')">Input Data Gedung</a>
        <a href="#" class="nav-item" onclick="showView('ruangan')">Input Data Ruangan</a>
        <a href="#" class="nav-item" onclick="showView('barang')">Input Data Barang</a>
        <a href="#" class="nav-item" onclick="showView('identitas')">Identitas</a>
        <a href="#" class="nav-item" onclick="showView('laporan')">Laporan</a>
      </nav>

      <main id="content-area">

        <!-- Beranda -->
        <section id="beranda-view" class="view">
          <h2>Dashboard</h2>
          <div class="card-container">
            <div class="card"><h4>Total</h4><p id="total-barang">0</p></div>
            <div class="card card-baik"><h4>Baik</h4><p id="total-baik">0</p></div>
            <div class="card card-rr"><h4>Rusak Ringan</h4><p id="total-rr">0</p></div>
            <div class="card card-rb"><h4>Rusak Berat</h4><p id="total-rb">0</p></div>
          </div>

          <div>
            <label>Pilih Ruangan:</label>
            <select id="filter-ruangan" onchange="updateDashboardRuangan()"></select>
          </div>
          <div class="chart-box">
            <canvas id="chartRuangan"></canvas>
          </div>

          <h3>Daftar Barang di Ruangan</h3>
          <table class="data-table">
            <thead>
              <tr><th>No</th><th>Nama Barang</th><th>Merk/Tipe</th><th>Jumlah</th><th>Kondisi</th></tr>
            </thead>
            <tbody id="dashboard-barang-body"></tbody>
          </table>
        </section>

        <!-- Gedung -->
        <section id="gedung-view" class="view" style="display:none;">
          <h2>Data Gedung</h2>
          <form onsubmit="saveGedung(event)">
            <input type="text" id="nama-gedung" placeholder="Nama Gedung" required>
            <input type="text" id="luas-gedung" placeholder="Luas Gedung">
            <input type="number" id="tahun-gedung" placeholder="Tahun">
            <input type="text" id="sumber-gedung" placeholder="Sumber Anggaran">
            <button type="submit">Tambah</button>
          </form>
          <table class="data-table">
            <thead><tr><th>No</th><th>Nama Gedung</th><th>Luas</th><th>Tahun</th><th>Sumber</th><th>Aksi</th></tr></thead>
            <tbody id="gedung-body"></tbody>
          </table>
        </section>

        <!-- Ruangan -->
        <section id="ruangan-view" class="view" style="display:none;">
          <h2>Data Ruangan</h2>
          <form onsubmit="saveRuangan(event)">
            <input type="text" id="nama-ruangan" placeholder="Nama Ruangan" required>
            <select id="gedung-select" required></select>
            <input type="text" id="penanggung-ruangan" placeholder="Penanggung Jawab">
            <button type="submit">Tambah</button>
          </form>
          <table class="data-table">
            <thead><tr><th>No</th><th>Nama Ruangan</th><th>Gedung</th><th>Penanggung Jawab</th><th>Aksi</th></tr></thead>
            <tbody id="ruangan-body"></tbody>
          </table>
        </section>

        <!-- Barang -->
        <section id="barang-view" class="view" style="display:none;">
          <h2>Data Barang</h2>
          <form onsubmit="saveBarang(event)">
            <select id="ruangan-select" required><option value="">-- Pilih Ruangan --</option></select>
            <input type="text" id="nama-barang" placeholder="Nama Barang" required>
            <input type="text" id="merk-barang" placeholder="Merk/Tipe">
            <input type="number" id="jumlah-barang" placeholder="Jumlah" required>
            <select id="kondisi-barang" required>
              <option value="B">Baik</option>
              <option value="RR">Rusak Ringan</option>
              <option value="RB">Rusak Berat</option>
            </select>
            <button type="submit">Tambah</button>
          </form>
          <table class="data-table">
            <thead>
              <tr><th>No</th><th>Nama</th><th>Merk</th><th>Jumlah</th><th>Ruangan</th><th>Kondisi</th><th>Aksi</th></tr>
            </thead>
            <tbody id="barang-body"></tbody>
          </table>
        </section>

        <!-- Identitas -->
        <section id="identitas-view" class="view" style="display:none;">
          <h2>Identitas Sekolah</h2>
          <form onsubmit="saveIdentitas(event)">
            <input type="text" id="nama-sekolah" placeholder="Nama Sekolah">
            <input type="text" id="alamat-sekolah" placeholder="Alamat Sekolah">
            <input type="text" id="logo-sekolah" placeholder="URL Logo Sekolah">
            <input type="text" id="bendahara-nama" placeholder="Nama Bendahara Barang">
            <input type="text" id="bendahara-nip" placeholder="NIP Bendahara Barang">
            <input type="text" id="pj-nama" placeholder="Nama Kepala Sekolah">
            <input type="text" id="pj-nip" placeholder="NIP Kepala Sekolah">
            <button type="submit">Simpan</button>
          </form>
        </section>

        <!-- Laporan -->
        <section id="laporan-view" class="view" style="display:none;">
          <div id="laporan-container">
            <div class="kop-laporan">
              <div style="display:flex; align-items:center; gap:15px;">
                <img id="lap-logo-sekolah" src="" alt="Logo Sekolah" height="80">
                <div>
                  <h3 id="lap-nama-sekolah">Nama Sekolah</h3>
                  <p id="lap-alamat-sekolah">Alamat Sekolah</p>
                </div>
              </div>
            </div>

            <hr style="margin:10px 0;">
            <h3 class="laporan-header">Laporan Inventaris</h3>

            <div style="margin:10px 0;">
              <label><b>Filter Ruangan:</b></label>
              <select id="laporan-filter-ruangan" onchange="tampilkanLaporanBarang()">
                <option value="">-- Semua Ruangan --</option>
              </select>

              <label style="margin-left:20px;"><b>Filter Kondisi:</b></label>
              <select id="laporan-filter-kondisi" onchange="tampilkanLaporanBarang()">
                <option value="">-- Semua Kondisi --</option>
                <option value="B">Baik</option>
                <option value="RR">Rusak Ringan</option>
                <option value="RB">Rusak Berat</option>
              </select>
            </div>

            <div style="margin:10px 0;">
              <label><b>Tanggal Cetak:</b></label>
              <input type="date" id="input-tanggal-cetak" onchange="updateTanggalCetakManual()">
              <span id="tanggal-cetak" style="margin-left:8px;"></span>
            </div>

            <table class="data-table">
              <thead>
                <tr><th>No</th><th>Nama Barang</th><th>Merk/Tipe</th><th>Jumlah</th><th>Kondisi</th></tr>
              </thead>
              <tbody id="laporan-body"></tbody>
            </table>

            <div class="ttd" style="display:flex; justify-content:space-between; margin-top:40px;">
              <div style="text-align:center;">
                <p>Kepala Sekolah</p><br><br><br>
                <p id="lap-pj-nama"></p>
                <p id="lap-pj-nip"></p>
              </div>
              <div style="text-align:center;">
                <p>Bendahara Barang</p><br><br><br>
                <p id="lap-bendahara-nama"></p>
                <p id="lap-bendahara-nip"></p>
              </div>
            </div>
          </div>
        </section>

      </main>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
